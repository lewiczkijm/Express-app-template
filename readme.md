# Шаблон веб приложения
На основе этого шаблона можно создать сайт или веб приложение.
Разработка ведется вокруг фреймворка Express 4. и нескольких middleware

Основные функции приложения:
- Аутентификация пользователей
- Контроль доступа к страницам и функциям rest api
- Автоматическая генерация одного или нескольких меню на основе данных роутинга
- Шаблонизация страниц модулем ejs c дополнением ejs-layout
- Административная панель для управления пользователями

## Middlewares
Главным элементом приложения являются middlewares моей разработки router, menu и access-user

### Router
router позволяет создавать новые страницы в декларативном стиле.
За образец routerа был взят роутинг из Sails с некоторыми дополнениями

`   kabinet: {
		name: "Личный кабинет",
		path: "get /lk",
		menu: true,
		view: "lk",
		access: rules.access.USER
	},
	users: {
		name: "Пользователи",
		path: "get /userslist",
		menu: true,
		action: function(req, res) {
			// код функции
		},
		access: rules.access.ADMIN
	}`

Здесь прописывается имя страницы, путь, шаблон страницы, если она статическая или функция, если динамическая.
Рендеринг статических страниц по умолчанию осуществляет функция - рендерер. При этом на страницу передается меню и данные пользователя.

### Menu
Генерирует список ссылок на разные страницы. При этом учитывается, имеет ли пользователь к ним доступ.
Меню может быть сгенерировано на основе тех же файлов, что и роутер

### Access-user
загружает данные пользователя и создает две переменные в объекте req: user и access
Эта прослойка намертво привязана к моей модели User

## MVC
Мой шаблон поддерживает парадигму MVC.
Контроллеры работают на базе routerа через стандартные для Express функции ` function(req,res){ `

Модель - стандартные классы ecmascript 6 с набором встроенных функций для доступа к базе данных.
В моем случае - mongodb
не это показалось удобнее, чем система sails с привязкой к ORM или классы mongose.
Классы можно расширять, не изменяя их файлы

`
	function extUser(cl){
		cl.prototype.addMoney = function(money){
			//
		}
		cl.types = [...] 
	}
`

В этом случае в данные пользователя из контроллера может быть добавлена любая переменная

Роль видов играют файлы ejs. ejs-layout позволяет создавать стандартные элементы документов,
таких как меню, пользовательская информация, вход в систему

`
	<%+ extend('layouts/standart') %>
	<%+ section('content') %>
		<script type="text/javascript">
			var users = <%- JSON.stringify(users,"",2) %>
		</script>
		<div id="rules"></div>
		<script type="text/javascript" src="/javascripts/control-users.js"></script>
	<%+ endSection %>
`
